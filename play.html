<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/play.css">
    <title>Circles with Words</title>
  </head>
  <body>
    <div class="im">
      <a href="index.html">
        <img class="ima" src="img/prev.png" alt=""> 
      </a>
    </div>
    <div class="circle">
      <div class="word"></div>
    </div>
    <div id="counter">Count: 0</div>
    <div id="timer">Time: </div>
    <div id="buttons">
      <button id="not-found">Таппады</button>
      <button id="found">Тапты</button>
    </div>
    <script>
      async function loadWords() {
        const response = await fetch('words.txt');
        const text = await response.text();
        const words = text.trim().split('\n');
        shuffleArray(words);
        return words;
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      // Game logic
      let words, currentIndex = 0, count = 0, notFoundWords = [];
      let timeLeft = 50;
      const wordEl = document.querySelector('.word');
      const foundBtn = document.querySelector('#found');
      const notFoundBtn = document.querySelector('#not-found');
      const counterEl = document.querySelector('#counter');
      const timerEl = document.querySelector('#timer');
      const punishmentInput = document.querySelector('#punishment');

      async function init() {
        words = await loadWords();
        showNextWord();
        setInterval(() => {
          timeLeft--;
          timerEl.textContent = 'Time: ' + timeLeft;
          if (timeLeft === 0) {
            localStorage.setItem('score', count);
            localStorage.setItem('notFoundWords', JSON.stringify(notFoundWords));
            window.location.href = 'rating.html';
          }
        }, 1000);
      }

      function showNextWord() {
        if (currentIndex >= words.length) {
          localStorage.setItem('score', count);
          localStorage.setItem('notFoundWords', JSON.stringify(notFoundWords));
          window.location.href = 'rating.html';
          return;
        }
        wordEl.textContent = words[currentIndex];
        currentIndex++;
      }
      
      function foundWord() {
        count++;
        counterEl.textContent = 'Count: ' + count;
        showNextWord();
      }

      function notFoundWord() {
        notFoundWords.push(words[currentIndex - 1]);
        showNextWord();
      }
      
      foundBtn.addEventListener('click', foundWord);
      notFoundBtn.addEventListener('click', notFoundWord);

      init();

      async function init() {
        words = await loadWords();
        showNextWord();
        const storedTime = localStorage.getItem('time');
        timeLeft = storedTime ? parseInt(storedTime) : 50; // use stored time if available, otherwise use default value of 50
        setInterval(() => {
          timeLeft--;
          timerEl.textContent = 'Time: ' + timeLeft;
          if (timeLeft === 0) {
            localStorage.setItem('score', count);
            localStorage.setItem('notFoundWords', JSON.stringify(notFoundWords));
            window.location.href = 'rating.html';
          }
        }, 1000);
      }
      
    </script>
  </body>
</html>
